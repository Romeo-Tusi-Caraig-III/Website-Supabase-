<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Likhayag â€” Sign in</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg-1: #0f766e;
    --bg-2: #064e3b;
    --card-bg: rgba(255,255,255,0.98);
    --muted: #58686d;
    --accent: #059669;
    --gold-1:#eab308;
    --gold-2:#ca8a04;
    --err: #dc2626;
    --shadow-lg: 0 24px 60px rgba(2,6,23,0.18);
    --glass: rgba(255,255,255,0.66);
    --input-text: #042f2c;
    --placeholder: #8fa2a0;
    --icon-fill: #556b67;
    --input-left-pad: 56px;
    --input-right-pad: 72px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    min-height:100%;
    font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    background: radial-gradient(900px 450px at 8% 8%, rgba(255,255,255,0.03), transparent),
                linear-gradient(180deg,var(--bg-1),var(--bg-2));
    -webkit-font-smoothing:antialiased;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:48px;
    color:#071422;
  }

  .card {
    width:100%;
    max-width:740px;
    border-radius:28px;
    background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.96));
    box-shadow: var(--shadow-lg);
    padding:48px;
    position:relative;
  }

  .brand {
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:14px;
    margin-bottom:26px;
  }

  .logo-img {
    width:160px;
    height:160px;
    border-radius:22px;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(135deg,var(--accent),var(--bg-2));
    box-shadow: 0 18px 44px rgba(5,150,105,0.14);
  }
  .logo-img img {
    max-width:100%;
    max-height:100%;
    object-fit:contain;
    display:block;
  }

  h1{
    margin:0;
    font-size:30px;
    font-weight:800;
    letter-spacing:-0.03em;
    color: #06323a;
  }
  .subtitle{
    margin:0;
    font-size:15px;
    color:var(--muted);
    font-weight:500;
  }

  /* Notification Banner */
  .notification {
    margin-bottom: 16px;
    padding: 14px 18px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 15px;
    display: flex;
    align-items: center;
    gap: 12px;
    animation: slideDown 0.3s ease;
  }
  .notification.success {
    background: #d1fae5;
    color: #065f46;
    border: 1px solid #a7f3d0;
  }
  .notification.error {
    background: #fee2e2;
    color: var(--err);
    border: 1px solid #fecaca;
  }
  .notification.info {
    background: #dbeafe;
    color: #1e40af;
    border: 1px solid #bfdbfe;
  }
  .notification.warning {
    background: #fef3c7;
    color: #92400e;
    border: 1px solid #fde68a;
  }
  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .form {
    margin-top:12px;
    display:flex;
    flex-direction:column;
    gap:14px;
  }

  label {
    display:block;
    margin-bottom:8px;
    font-size:15px;
    font-weight:600;
    color:#06323a;
  }

  .input-row{
    position:relative;
    display:flex;
    align-items:center;
  }

  .input {
    width:100%;
    border-radius:14px;
    padding:14px 16px;
    padding-left: var(--input-left-pad);
    padding-right: var(--input-right-pad);
    border:1px solid rgba(15,23,42,0.06);
    background: linear-gradient(180deg,var(--glass),var(--card-bg));
    font-size:16px;
    line-height:20px;
    color: var(--input-text) !important;
    -webkit-text-fill-color: var(--input-text) !important;
    transition: box-shadow .18s, border-color .18s;
    outline:none;
  }

  .input::placeholder { color: var(--placeholder); opacity: 1; }
  .input::-webkit-input-placeholder { color: var(--placeholder); }
  .input::-moz-placeholder { color: var(--placeholder); opacity:1; }
  .input:-ms-input-placeholder { color: var(--placeholder); }
  .input::-ms-input-placeholder { color: var(--placeholder); }

  .input.error {
    border-color: var(--err);
    background: #fff2f2;
  }

  .input:focus{
    box-shadow: 0 14px 36px rgba(5,150,105,0.08);
    border-color: rgba(5,150,105,0.95);
  }

  .icon {
    position:absolute;
    left:12px;
    top:50%;
    transform:translateY(-50%);
    width:28px;
    height:28px;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
    z-index:3;
  }
  .icon svg{ width:20px; height:20px; display:block; fill: var(--icon-fill); }

  .icon-right {
    position:absolute;
    right:8px;
    top:50%;
    transform:translateY(-50%);
    z-index:4;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .toggle svg {
    width:20px;
    height:20px;
    display:block;
    stroke: var(--accent);
    fill: none;
    stroke-width: 1.6;
    stroke-linecap: round;
    stroke-linejoin: round;
  }
  .toggle { 
    background:transparent; 
    border:0; 
    padding:8px; 
    border-radius:10px; 
    cursor:pointer; 
    display:inline-flex; 
    align-items:center; 
    justify-content:center;
    transition: all 0.2s;
  }
  .toggle:focus{ outline:2px solid rgba(5,150,105,0.12); outline-offset:2px; }
  .toggle:hover{ background: rgba(5,150,105,0.06); transform: translateY(-1px); }

  .help {
    font-size:13px;
    color:var(--muted);
    margin-top:8px;
  }

  .error-text {
    color: var(--err);
    font-size: 13px;
    margin-top: 8px;
    display: none;
  }

  .row-between{ display:flex; align-items:center; justify-content:space-between; margin-top:8px; }

  .remember{ display:flex; gap:10px; align-items:center; color:var(--muted); font-size:15px; }
  .checkbox{ width:18px; height:18px; accent-color:var(--accent); cursor: pointer; }

  .forgot { 
    font-size:15px; 
    color:var(--accent); 
    text-decoration:none; 
    font-weight:700; 
    cursor:pointer;
    transition: all 0.2s;
  }
  .forgot:hover {
    text-decoration: underline;
  }

  .btn {
    margin-top:14px;
    border:0;
    padding:16px 20px;
    border-radius:999px;
    font-weight:800;
    background:linear-gradient(90deg,var(--gold-1),var(--gold-2));
    color:#fff;
    letter-spacing:0.9px;
    font-size:15px;
    cursor:pointer;
    box-shadow: 0 12px 40px rgba(234,179,8,0.18);
    transition: all 0.2s;
  }
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 16px 48px rgba(234,179,8,0.24);
  }
  .btn:active{ transform: translateY(1px); }
  .btn:disabled{ opacity:.6; cursor:default; transform: none; }

  .divider {
    margin:26px 0 12px; text-align:center; position:relative; font-size:15px; color:var(--muted);
  }
  .divider::before{
    content:""; position:absolute; left:20px; right:20px; top:50%; height:1px; background:linear-gradient(90deg,transparent,#e6eef0,transparent);
    transform:translateY(-50%); border-radius:2px; z-index:0;
  }
  .divider span{ position:relative; z-index:1; padding:10px 18px; background:transparent; border-radius:999px; color:var(--muted); }

  .footer{ text-align:center; margin-top:14px; font-size:15px; color:var(--muted); }
  .footer a{ color:var(--accent); font-weight:800; text-decoration:none; transition: all 0.2s; }
  .footer a:hover { text-decoration: underline; }

  /* Modal styles */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(2,6,23,0.45);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:1200;
    padding: 24px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .modal-overlay.show {
    opacity: 1;
    pointer-events: auto;
  }

  .modal-card {
    width:100%;
    max-width:520px;
    border-radius:14px;
    background: linear-gradient(180deg,#ffffff,#fbfbfb);
    box-shadow: 0 30px 80px rgba(3,10,18,0.35);
    padding:20px 20px 18px;
    transform: scale(0.95);
    opacity: 0;
    transition: all 0.2s;
  }
  .modal-overlay.show .modal-card {
    transform: scale(1);
    opacity: 1;
  }

  .modal-title {
    font-weight:800;
    font-size:18px;
    color:#0b2624;
    margin-bottom:6px;
  }
  .modal-desc {
    color:var(--muted);
    font-size:14px;
    margin-bottom:14px;
  }

  .modal-input {
    width:100%;
    border-radius:10px;
    padding:12px 14px;
    border:1px solid rgba(15,23,42,0.06);
    font-size:15px;
    color:var(--input-text);
    background: #fff;
    box-shadow: inset 0 1px 0 rgba(0,0,0,0.02);
  }

  .modal-row {
    display:flex;
    gap:12px;
    justify-content:flex-end;
    align-items:center;
    margin-top:14px;
  }

  .modal-btn {
    padding:10px 14px;
    border-radius:10px;
    border:0;
    cursor:pointer;
    font-weight:700;
    transition: all 0.2s;
  }
  .modal-btn.cancel {
    background:transparent;
    color:#1f2937;
  }
  .modal-btn.cancel:hover {
    background: rgba(0,0,0,0.05);
  }
  .modal-btn.send {
    background: linear-gradient(90deg,var(--gold-1),var(--gold-2));
    color:#fff;
    box-shadow: 0 12px 30px rgba(234,179,8,0.16);
  }
  .modal-btn.send:hover {
    transform: translateY(-2px);
    box-shadow: 0 16px 36px rgba(234,179,8,0.22);
  }
  .modal-btn:disabled {
    opacity: 0.6;
    cursor: default;
    transform: none;
  }

  .modal-msg {
    margin-top:10px;
    font-size:14px;
    padding: 10px;
    border-radius: 8px;
  }
  .modal-msg.success { 
    color: #065f46; 
    background: #d1fae5;
    border: 1px solid #a7f3d0;
  }
  .modal-msg.error { 
    color: var(--err); 
    background: #fee2e2;
    border: 1px solid #fecaca;
  }

  @media (max-width:720px){
    .card{ padding:28px; max-width:92%; }
    .logo-img{ width:120px; height:120px; }
    h1{ font-size:22px; }
    .modal-card { padding:16px; }
  }
</style>
</head>
<body>

  <main class="card" role="main" aria-labelledby="signin-title">
    <header class="brand">
      <div class="logo-img" aria-hidden="false">
        <img src="/static/images/likhayag-logo.png" alt="Likhayag logo">
      </div>

      <h1 id="signin-title">Likhayag Login</h1>
      <p class="subtitle">Sign in to your Likhayag Organization Account</p>
    </header>

    <div id="notificationContainer" aria-live="polite"></div>

    <form id="loginForm" class="form" method="POST" novalidate>
      <!-- EMAIL -->
      <div>
        <label for="email">Email</label>
        <div class="input-row" style="position:relative">
          <div class="icon" aria-hidden="true" title="Email">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M3 6.5C3 5.1 4.1 4 5.5 4h13c1.4 0 2.5 1.1 2.5 2.5v11c0 1.4-1.1 2.5-2.5 2.5h-13C4.1 20 3 18.9 3 17.5v-11zM5 7.5l7 5 7-5"/>
            </svg>
          </div>

          <input id="email" name="email" class="input" type="email" placeholder="student@gmail.com" required aria-describedby="emailError" autocomplete="email" />
        </div>
        <div id="emailError" class="error-text">Please enter a valid email address</div>
      </div>

      <!-- PASSWORD -->
      <div>
        <label for="password">Password</label>
        <div class="input-row" style="position:relative">
          <div class="icon" aria-hidden="true" title="Password">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M6 10V7a6 6 0 0 1 12 0v3h1a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-9a1 1 0 0 1 1-1h1zm3 0h6V7a3 3 0 0 0-6 0v3z"/>
            </svg>
          </div>

          <input id="password" name="password" class="input" type="password" placeholder="Enter your password" required aria-describedby="passwordError" autocomplete="current-password" />
          
          <div class="icon-right">
            <button type="button" id="togglePassword" class="toggle" aria-label="Show password" title="Show/hide password">
              <svg id="eyeIcon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            </button>
          </div>
        </div>

        <div id="passwordError" class="error-text">Password is required</div>
      </div>

      <div class="row-between" style="margin-top:12px">
        <label class="remember">
          <input type="checkbox" class="checkbox" name="remember" /> 
          Remember me
        </label>
        <a id="forgotLink" class="forgot" href="#">Forgot password?</a>
      </div>

      <button type="submit" class="btn" aria-live="polite">Sign In</button>

      <div class="divider"><span>or</span></div>

      <div class="footer">Don't have an account? <a href="/signup">Sign up</a></div>
    </form>
  </main>

  <!-- Forgot Password Modal -->
  <div id="forgotModal" class="modal-overlay" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="forgotTitle">
      <div class="modal-title" id="forgotTitle">Reset your password</div>
      <div class="modal-desc">Enter your email and we'll send a verification code to reset your password.</div>
      
      <input id="fpEmail" type="email" class="modal-input" placeholder="you@gmail.com" />
      
      <div id="fpMsg" class="modal-msg" style="display:none"></div>
      
      <div class="modal-row">
        <button id="fpCancel" class="modal-btn cancel">Cancel</button>
        <button id="fpSend" class="modal-btn send">Send Code</button>
      </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const emailEl = document.getElementById('email');
  const pwdEl = document.getElementById('password');
  const toggleBtn = document.getElementById('togglePassword');
  const eyeIcon = document.getElementById('eyeIcon');
  const forgotLink = document.getElementById('forgotLink');
  const notificationContainer = document.getElementById('notificationContainer');
  const form = document.getElementById('loginForm');

  const allowedAdmin = "admin@admin.com";

  function showNotification(message, type='info'){
    if (!notificationContainer) return;
    
    notificationContainer.innerHTML = '';
    const div = document.createElement('div');
    div.className = `notification ${type}`;
    div.textContent = message;
    notificationContainer.appendChild(div);
    
    setTimeout(()=> { 
      if(div.parentNode) div.remove(); 
    }, 6000);
  }

  function validEmail(email) {
    return email && email.includes('@') && email.includes('.');
  }

  function validGmailOrAdmin(email) {
    return email.endsWith('@gmail.com') || email === allowedAdmin;
  }

  // Live input validation feedback
  emailEl.addEventListener('blur', () => {
    const v = emailEl.value.trim();
    const emailErrorEl = document.getElementById('emailError');
    
    if(v && !validEmail(v)){
      emailErrorEl.textContent = 'Please enter a valid email address';
      emailErrorEl.style.display = 'block';
      emailEl.classList.add('error');
    } else if(v && !validGmailOrAdmin(v)) {
      emailErrorEl.textContent = 'Email must be Gmail (@gmail.com) or admin account';
      emailErrorEl.style.display = 'block';
      emailEl.classList.add('error');
    } else {
      emailErrorEl.style.display = 'none';
      emailEl.classList.remove('error');
    }
  });

  pwdEl.addEventListener('blur', () => {
    const v = pwdEl.value;
    const pwdErrorEl = document.getElementById('passwordError');
    
    if(!v || v.length < 1){
      pwdErrorEl.style.display = 'block';
      pwdEl.classList.add('error');
    } else {
      pwdErrorEl.style.display = 'none';
      pwdEl.classList.remove('error');
    }
  });

  // Toggle password visibility
  toggleBtn.addEventListener('click', () => {
    const current = pwdEl.getAttribute('type');
    if(current === 'password'){
      pwdEl.setAttribute('type','text');
      toggleBtn.setAttribute('aria-label','Hide password');
      eyeIcon.innerHTML =
        '<path d="M3 3l18 18"></path>' +
        '<path d="M9.88 9.88a3 3 0 104.24 4.24"></path>' +
        '<path d="M2.46 12C3.73 7.94 7.52 5 12 5c1.63 0 3.14.37 4.5 1.03"></path>';
    } else {
      pwdEl.setAttribute('type','password');
      toggleBtn.setAttribute('aria-label','Show password');
      eyeIcon.innerHTML =
        '<path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>' +
        '<circle cx="12" cy="12" r="3"></circle>';
    }
  });

  // Forgot password modal
  forgotLink.addEventListener('click', (e)=>{
    e.preventDefault();
    openForgotModal();
  });

  function openForgotModal(){
    const overlay = document.getElementById('forgotModal');
    if (!overlay) return;
    
    overlay.classList.add('show');
    overlay.setAttribute('aria-hidden', 'false');
    
    const fpEmail = document.getElementById('fpEmail');
    const fpMsg = document.getElementById('fpMsg');
    const fpCancel = document.getElementById('fpCancel');
    const fpSend = document.getElementById('fpSend');

    fpEmail.value = '';
    fpMsg.style.display = 'none';

    fpCancel.onclick = () => {
      overlay.classList.remove('show');
      overlay.setAttribute('aria-hidden', 'true');
    };

    overlay.onclick = (ev) => {
      if(ev.target === overlay) {
        overlay.classList.remove('show');
        overlay.setAttribute('aria-hidden', 'true');
      }
    };

    fpSend.onclick = async () => {
      const email = fpEmail.value.trim();
      
      if(!email){
        fpMsg.style.display = 'block';
        fpMsg.className = 'modal-msg error';
        fpMsg.textContent = 'Please enter your email.';
        return;
      }
      
      if(!validGmailOrAdmin(email)){
        fpMsg.style.display = 'block';
        fpMsg.className = 'modal-msg error';
        fpMsg.textContent = 'Please enter a valid Gmail address or admin account.';
        return;
      }

      fpMsg.style.display = 'none';
      fpSend.disabled = true;
      fpSend.textContent = 'Sending...';

      try {
        const res = await fetch('/api/forgot-password', {
          method:'POST',
          credentials:'same-origin',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ email })
        });
        
        const data = await res.json().catch(()=>({}));
        
        if(!res.ok) {
          fpMsg.style.display = 'block';
          fpMsg.className = 'modal-msg error';
          fpMsg.textContent = data.message || 'Failed to send reset email';
        } else {
          fpMsg.style.display = 'block';
          fpMsg.className = 'modal-msg success';
          fpMsg.textContent = data.message || 'If that email exists, a reset code has been sent.';
          
          setTimeout(()=> {
            overlay.classList.remove('show');
            overlay.setAttribute('aria-hidden', 'true');
          }, 2000);
        }
      } catch(err){
        fpMsg.style.display = 'block';
        fpMsg.className = 'modal-msg error';
        fpMsg.textContent = 'Network error. Please try again.';
      } finally {
        fpSend.disabled = false;
        fpSend.textContent = 'Send Code';
      }
    };
  }

  // Form submission
  form.addEventListener('submit', async function(e){
    e.preventDefault();
    
    // Clear previous errors
    document.querySelectorAll('.error-text').forEach(el => el.style.display = 'none');
    document.querySelectorAll('.input').forEach(el => el.classList.remove('error'));
    
    const email = emailEl.value.trim();
    const password = pwdEl.value;
    const remember = !!form.querySelector('input[name="remember"]')?.checked;

    let hasError = false;

    // Validate email
    if(!email || !validEmail(email)){
      document.getElementById('emailError').textContent = 'Please enter a valid email address';
      document.getElementById('emailError').style.display = 'block';
      emailEl.classList.add('error');
      hasError = true;
    } else if(!validGmailOrAdmin(email)){
      document.getElementById('emailError').textContent = 'Email must be Gmail (@gmail.com) or admin account';
      document.getElementById('emailError').style.display = 'block';
      emailEl.classList.add('error');
      hasError = true;
    }

    // Validate password
    if(!password || password.length < 1){
      document.getElementById('passwordError').style.display = 'block';
      pwdEl.classList.add('error');
      hasError = true;
    }

    if(hasError){
      showNotification('Please fix the errors before continuing', 'error');
      return;
    }

    const submitBtn = form.querySelector('button[type="submit"]');
    const prevText = submitBtn.textContent;
    submitBtn.disabled = true;
    submitBtn.textContent = 'Signing in...';

    try {
      const res = await fetch('/api/login', {
        method:'POST',
        credentials:'same-origin',
        headers:{ 
          'Content-Type':'application/json',
          'Accept':'application/json' 
        },
        body: JSON.stringify({ email, password, remember })
      });
      
      const data = await res.json().catch(()=>({}));
      
      if(!res.ok) {
        if(res.status === 403) {
          showNotification(data.message || 'Account not verified. Please check your email.', 'warning');
        } else if(res.status === 401) {
          showNotification(data.message || 'Invalid email or password', 'error');
        } else {
          showNotification(data.message || 'Login failed. Please try again.', 'error');
        }
      } else {
        showNotification(data.message || 'Login successful! Redirecting...', 'success');
        
        setTimeout(()=>{ 
          window.location.href = data.redirect_url || '/interface'; 
        }, 800);
      }
    } catch(err){
      console.error('Login error', err);
      showNotification('Network error. Please check your connection and try again.', 'error');
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = prevText;
    }
  });
});
</script>
</body>
</html>